# AI Browser Researcher 演进路径

## 设计合理性判断框架

### 代理抽象的4个判断标准
1. **独特价值测试**：删除这个代理，能否用更简单的方式实现？
2. **复杂度匹配测试**：代理的复杂度是否与解决的问题匹配？
3. **用户验证测试**：有真实用户场景需要这个抽象吗？
4. **技术必要性测试**：是否有技术原因必须要这层抽象？

### 当前状态评估
- **BrowserAgent**: ❌❌❌❌ (0/4) - 纯模拟，无真实价值
- **ExtractorAgent**: ❌❌❌❌ (0/4) - 重复MCP功能，无增值
- **记忆系统**: ⚠️ 产品功能而非工作流核心

## Phase 1: 诚实的MVP (立即执行)

### 核心改动
```typescript
// 从5步简化为3步核心流程
Plan → Search/Browse → Report

// 删除模拟代理，直接调用MCP
Browser/Extractor → 直接调用MCP research-tools
```

### 实现要点
1. **HonestResearchWorkflow** (`src/workflow/honest-engine.ts`)
   - 直接调用MCP工具，无代理抽象
   - 智能决策是否需要完整内容
   - 透明的降级策略

2. **智能内容获取规则**
   - 最多获取5个完整内容（成本控制）
   - 优先获取权威来源（.edu/.gov/wikipedia）
   - snippet足够详细时跳过完整获取

3. **关键指标**
   - 端到端真实功能：100%
   - 模拟组件：0
   - 核心价值链完整性：✅

## Phase 2: 用户反馈驱动 (1-2周后)

### 决策树
```
用户反馈："经常获取失败" 
  → 考虑IntelligentBrowser
  → 处理：登录、验证码、动态内容、rate limiting

用户反馈："内容质量不好"
  → 考虑ContentIntelligence  
  → 处理：多源融合、质量评估、相关性判断

用户反馈："需要记住之前的研究"
  → 考虑MemorySystem
  → 处理：向量存储、语义检索、知识图谱
```

### 升级条件触发器
| 功能 | 触发条件 | 当前替代方案 |
|------|---------|-------------|
| BrowserAgent | 失败率>30% 或 需要交互 | 直接调用MCP |
| ExtractorAgent | 质量评分<0.6 或 需要领域特定提取 | MCP research-tools |
| MemorySystem | 用户>10 或 研究主题重复>3次 | 文件系统存储 |

## Phase 3: 智能化升级 (1个月后)

### IntelligentBrowser (当且仅当需要时)
```typescript
class IntelligentBrowser extends Agent {
  // 只有在以下场景才合理：
  
  async handleAntiScraping() {
    // - User-Agent轮换
    // - 请求频率控制
    // - 代理池管理
  }
  
  async handleDynamicContent() {
    // - 等待Ajax加载
    // - 滚动加载更多
    // - SPA路由导航
  }
  
  async handleAuthentication() {
    // - Cookie管理
    // - Session维持
    // - OAuth流程
  }
  
  async intelligentNavigation() {
    // - 链接相关性判断
    // - 深度优先/广度优先
    // - 内容去重
  }
}
```

### ContentIntelligence (当且仅当需要时)
```typescript
class ContentIntelligence extends Agent {
  // 只有在以下场景才合理：
  
  async multiSourceFusion() {
    // - 搜索结果 + 网页 + PDF + 视频字幕
    // - 时间线对齐
    // - 观点聚合
  }
  
  async domainSpecificExtraction() {
    // - 学术论文：方法/结果/结论
    // - 新闻：5W1H
    // - 产品：规格/价格/评论
  }
  
  async credibilityAssessment() {
    // - 来源可信度
    // - 交叉验证
    // - 事实核查
  }
  
  async semanticAnalysis() {
    // - 主题建模
    // - 情感分析
    // - 立场检测
  }
}
```

## 演进原则

### 1. 价值驱动
- ✅ 每个组件必须解决真实问题
- ✅ 复杂度必须匹配价值
- ❌ 避免为架构而架构

### 2. 渐进式增强
```
简单直接调用 → 智能封装 → 代理抽象
     ↑              ↑            ↑
   MVP阶段     有明确需求    复杂逻辑
```

### 3. 可测试性
- 每个组件独立可测试
- 有明确的成功指标
- 可以独立部署和回滚

### 4. 用户中心
- 基于真实反馈，而非假设
- 优先解决痛点，而非完美架构
- 保持透明和可解释

## 反模式警示

### ❌ 避免这些错误
1. **过早抽象**：在验证核心功能前就创建复杂架构
2. **功能蔓延**：添加"可能有用"但未验证的功能
3. **模拟驱动开发**：用模拟数据验证架构而非真实功能
4. **过度工程**：为10个用户设计支持10000用户的系统

### ✅ 正确的做法
1. **先让简单的工作**：3步MVP优于5步模拟
2. **真实数据验证**：每个组件都有真实输入输出
3. **按需扩展**：有明确需求再添加复杂度
4. **持续重构**：保持代码简洁，及时清理技术债

## 成功指标

### Phase 1 (MVP)
- [ ] 端到端工作流可运行
- [ ] 至少50%来源获取成功
- [ ] 生成的报告包含真实内容
- [ ] 零模拟组件

### Phase 2 (反馈驱动)
- [ ] 基于10+用户反馈的改进
- [ ] 失败率降低50%
- [ ] 内容质量评分>0.7
- [ ] 有明确的升级决策记录

### Phase 3 (智能化)
- [ ] 每个智能组件有3+独特功能
- [ ] 性能提升可量化（>30%）
- [ ] 用户满意度>8/10
- [ ] 架构复杂度匹配实际需求

## 技术债务管理

### 当前技术债
1. **模拟代理** - 立即清理
2. **MCP集成不完整** - Phase 1完成
3. **缺少集成测试** - Phase 1添加

### 预防措施
1. **代码审查**：每个PR必须说明价值
2. **架构决策记录**：ADR文档跟踪
3. **定期清理**：每月技术债review
4. **指标监控**：跟踪复杂度vs价值

## 总结

**核心理念**：先让简单的东西真正工作，再考虑复杂的抽象。

**当前行动**：
1. 立即部署`HonestResearchWorkflow`
2. 收集真实用户反馈
3. 基于数据决定下一步

**长期愿景**：
- 不是最复杂的架构
- 而是最适合的架构
- 每一行代码都有其存在的理由